<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/situation_style.css}">
    <script th:src="@{/js/situation_script.js}"></script>

    <title>Lagebericht</title>

</head>
<body>
<div layout:fragment="content" class="container">
    <h1>Lagebericht</h1>
    <form id="situation-form" action="#" th:object="${questionnaire}" method="post">
        <input type="hidden" th:field="*{id}">
        <th:block th:each="branchQuestionnaire, iter1: *{branchQuestionnaires}"
                  th:with="isSectorChanged=${sectorChangeDetector.isSectorChanged(branchQuestionnaire.getBranch().getSector())},
                           sector=${branchQuestionnaire.getBranch().getSector()}">
            <input type="hidden" th:field="*{branchQuestionnaires[__${iter1.index}__].id}">
            <input type="hidden" th:field="*{branchQuestionnaires[__${iter1.index}__].branch.id}">
            <h2 class="sector-h2" th:attr="data-branch_class=${'branch-div-' + sector.getId()}"
                th:id="${'sector-h2-' + sector.getId()}"
                th:if="${isSectorChanged}">
                <i class="bi bi-diamond"></i>
                <span th:text="${sector.getName()}"></span>
            </h2>

            <div th:attr="data-sector_h2_id=${'sector-h2-' + sector.getId()}"
                 th:class="${'branch-div branch-div-' + sector.getId()}">
                <h4>
                    <i class="bi bi-diamond"></i>
                    <span th:text="${branchQuestionnaire.getBranch().getName()}"></span>
                </h4>
                <div class="input-div description-div" th:each="userScenario, iter2: ${branchQuestionnaire.userScenarios}">
                    <p th:text="${userScenario.getScenario().getDescription()}" class="description-p"></p>
                    <div class="input-div without-description-div">
                        <input type="hidden" th:field="*{branchQuestionnaires[__${iter1.index}__].userScenarios[__${iter2.index}__].id}">
                        <input type="hidden" th:field="*{branchQuestionnaires[__${iter1.index}__].userScenarios[__${iter2.index}__].scenario.id}">
                        <select th:if="${userScenario.getScenario().getScenarioType().isWithSelection()}" onchange="onSelectionChange(this)"
                                th:field="*{branchQuestionnaires[__${iter1.index}__].userScenarios[__${iter2.index}__].value}" class="form-select value-select" >
                            <option value="0">unbekannt</option>
                            <option value="1">keine / gar nicht</option>
                            <option value="2">gering</option>
                            <option value="3">erheblich</option>
                            <option value="4">massiv</option>
                        </select>

                        <textarea maxlength="1024" placeholder="Kommentar..." class="form-control comment-textarea" th:field="*{branchQuestionnaires[__${iter1.index}__].userScenarios[__${iter2.index}__].comment}"></textarea>
                    </div>
                </div>
            </div>
        </th:block>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button type="button" onclick="submitForm()" class="btn btn-primary">Speichern</button>
    </form>

</div>
</body>
</html>